/*global document, jQuery, window*/

/*!
 * jQuery Personality Quiz Plugin
 * Original author: @justmarkup
 * Licensed under the MIT license
 */
(function(e,t,n){"use strict";function b(t,n){this.element=t;this.options=e.extend({},i,n);this._defaults=i;this._name=r;this.init()}var r="jumaQuiz",i={container:"juma-quiz",progress:true},s,o,u,a,f=[],l=0,c,h,p=0,d,v,m,g,y;b.prototype={init:function(){g="#"+this.options.container;s=g+" > li";if(this.options.progress!==false){this.addProgress()}this.setActive(s);this.answer(g)},addProgress:function(){e(g).before('<div class="juma-progress"><span></span></div>');y=e(g).outerWidth();d=".juma-progress";m=e(d+"> span");e(d).css("width",y)},setActive:function(t){e("html").addClass("js");e(g).after('<button class="juma-forward">Next</button>');o=e(".juma-forward");o.attr("disabled","disabled");if(!e(t).hasClass("active")){e(t+":first-child").addClass("active")}},answer:function(t){u=e(s+"> ul li");o=e(".juma-forward");u.click(function(){u.removeClass("juma-choice");o.attr("disabled","disabled");a=e(s+".active").data("question");o.removeAttr("disabled");e(this).addClass("juma-choice")});o.click(function(){f[a]=e(".juma-choice").data("points");l+=f[a];a=e(s+".active");if(a.is(":last-child")){e(".juma-progress > span").css("width",y);e(t).hide();o.hide();h=e(".juma-score li").length;for(p;p<h;p+=1){var n=e(".juma-score li")[p];if(l<=e(n).data("points")){e(n).show();return}}}else{e(s).removeClass("active");a.next("li").addClass("active");o.attr("disabled","disabled");m.css("width",y/e(s).length);v=parseInt(m.css("width"),10);e(".juma-progress > span").css("width",v*(e(".active").data("question")-1)+"px")}})}};e.fn[r]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+r)){e.data(this,"plugin_"+r,new b(this,t))}})}})(jQuery,window,document)