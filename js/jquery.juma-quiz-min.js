/*global jQuery*/

/*!
 * jQuery Personality Quiz Plugin
 * Original author: Michael Scharnagl @justmarkup
 * Version 0.2.0
 * Licensed under the MIT license
 */
(function(e){"use strict";function g(i,s){this.element=i;this.options=e.extend({},r,s);n=this.options;this._defaults=r;this._name=t;this.init()}function y(){e(v).before('<div class="juma-progress"><span></span></div>');m=e(v).outerWidth();h=".juma-progress";d=e(h+"> span");e(h).css("width",m)}function b(t){e("html").addClass("js");if(!n.nextAuto){e(v).after('<button type="submit" title="Show next question" class="juma-forward">Next</button>')}s=e(".juma-forward");s.attr("disabled","disabled");if(!e(t).hasClass("active")){e(t+":first-child").addClass("active")}}function w(){o=e(i+"> ul li");s=e(".juma-forward");o.on("click keydown",function(t){if(t.which==1||t.which==13){o.removeClass("juma-choice");o.attr("aria-checked",false);s.attr("disabled","disabled");u=e(i+".active").data("question");s.removeAttr("disabled");e(this).addClass("juma-choice");e(this).attr("aria-checked",true);if(n.nextAuto){E()}}else{}});if(!n.nextAuto){s.click(function(){E()})}}function E(){a[u]=e(".juma-choice").data("points");f+=a[u];u=e(i+".active");if(u.is(":last-child")){e(".juma-progress > span").css("width",m);e(v).hide();s.hide();l=e(".juma-score li").length;for(c;c<l;c+=1){var t=e(".juma-score li")[c];if(f<=e(t).data("points")){e(t).show();if(n.showFinalScore){e(".juma-final-score").text(f)}return}}}else{e(i).removeClass("active");u.next("li").addClass("active");s.attr("disabled","disabled");if(n.progress){d.css("width",m/e(i).length);p=parseInt(d.css("width"),10);e(".juma-progress > span").css("width",p*(e(".active").data("question")-1)+"px")}}}var t="jumaQuiz",n,r={container:"juma-quiz",progress:true,nextAuto:false,showFinalScore:false},i,s,o,u,a=[],f=0,l,c=0,h,p,d,v,m;g.prototype={init:function(){v="#"+n.container;i=v+" > li";if(n.progress){y()}b(i);w()}};e.fn[t]=function(n){return this.each(function(){if(!e.data(this,"plugin_"+t)){e.data(this,"plugin_"+t,new g(this,n))}})}})(jQuery)